<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
            integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/static/echarts.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='mystyle.css') }}">
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <title>Title</title>
    <style>
        .b {
            position: absolute;
            right: 80px
        }

        .form-group {
            margin-right: 40px;
        }

        .form-inline {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>


<div class="container py-5">

    <!-- For demo purpose -->
    <div class="row mb-4">
        <div class="col-lg-8 mx-auto text-center">
            <h1 class="display-4">F1-race Predictor</h1>
        </div>
    </div>
    <form action="#" method="post" name="form_name" id="form_id" class="form_class" hidden>
        <input type="text" name="text1" id="word" placeholder="Name" hidden/>
        <input type="text" name="text2" id="word2" placeholder="Name" hidden/>
        <input type="text" name="text3" id="word4" placeholder="Name" hidden/>
        <input type="text" name="oper" id="word3" placeholder="Name" hidden/>
    </form>


    <form class="row">
        <div class="col-lg-7 mx-auto">
            <div class="bg-white rounded-lg shadow-sm p-5">
                <!-- Credit card form content -->
                <div class="tab-content">
                    <!-- Paypal info -->
                    <div id="nav-tab-feature" class="tab-pane fade show active">

<!--                        <dt data-toggle="tooltip"-->
<!--                            title="Predict one line produced the probability of this driver winning. Predict multiple line produce which drive can win">-->
<!--                            Prediction-->
<!--                            Selection-->
<!--                            <i class="fa fa-question-circle"></i>-->
<!--                        </dt>-->
<!--                        <div class="form-group">-->
<!--                            <select class="form-control" id="featsel" onchange="featshow()">-->
<!--                                <option value="all" selected>Predict one line</option>-->
<!--                                <option value="remove">Predict multiple line</option>-->
<!--                            </select>-->
<!--                        </div>-->
<!--                        <p style="display: none" id="text">season, round, weather, circuit_id should be same for multiple drivers in the same race</p>-->
                            <dt data-toggle="tooltip"
                                title="Predicting the one who have the best chance to win in multiple drivers">
                                <h5><b>Prediction <i class="fa fa-question-circle"></i></b></h5>

                            </dt>

                            <p id="text">Rule1: There should be at least 2 drivers. <br>Rule2: season, round, weather, circuit_id should be same for multiple drivers in the same race

<!--                        <button style="display:none;" id="addfeat" type="button"-->
<!--                                onclick="addElement('feats','div','form-group')"-->
<!--                                class="subscribe btn btn-primary btn-block rounded-pill shadow-sm">-->
<!--                            Add a Line-->
<!--                        </button>-->
                        <button  id="addfeat" type="button"
                                onclick="addElement('feats','div','form-group')"
                                class="subscribe btn btn-primary btn-block rounded-pill shadow-sm">
                            Add a Line
                        </button>
                        <div id="feats" class="form">
                        <div class = "row">
                                    <div class="form-group col">
                                    <dt data-toggle="tooltip"
                                        title="The year of the race">
                                        <label for="season">season</label>
                                        <i class="fa fa-question-circle"></i>
                                        <input type="text" id="season" name="season" value="2019" class="form-control"
                                           placeholder="season">
                                    </dt>
                                </div>
                                <div class="form-group col">
                                    <dt data-toggle="tooltip" title="Multiple races happen each season. About 15-20 per season.
                                            Later races usually see more experience racer and more experienced constructors performing better.">
                                    <label for="round">round</label>
                                    <i class="fa fa-question-circle"></i>
                                    <input type="text" id="round" name="round" value="21" class="form-control" placeholder="round">
                                    </dt>
                                </div>
                                <div class="form-group col">
                                    <dt data-toggle="tooltip" title="Weather during the race">
                                <label for="weather0">weather</label>
                                        <i class="fa fa-question-circle"></i>
                                <select  class="form-control" id="weather0">
                                    <option value="warm" selected>warm</option>
                                    <option value="cold">cold</option>
                                    <option value="dry">dry</option>
                                    <option value="wet">wet</option>
                                    <option value="cloudy">cloudy</option>
                                </select></dt></div>


                            </div>
                            <div class = "row">
                                <div class="form-group col">
                                    <dt data-toggle="tooltip" title="Which circuit the race is held in. Very important feature. A racer in his home
                                                nation circuit has familiarity advantage and likely to perform well. There are about 60 unique circuits around
                                                the world.">
                                    <label for="circuit_id">circuit_id</label>
                                        <i class="fa fa-question-circle"></i>
                                    <input type="text" id="circuit_id" value="yas_marina" name="circuit_id" class="form-control"
                                           placeholder="circuit_id">
                                        </dt>
                                </div>
                                <div class="form-group col">
                                    <dt data-toggle="tooltip" title="Grid position the racer starts from. Basically previous races winner will be in the 1st
                                    grid, so basically ahead of everyone. Very important feaature.">
                                    <label for="grid">grid</label>
                                        <i class="fa fa-question-circle"></i>
                                    <input type="text" id="grid" name="grid" value="20" class="form-control"
                                           placeholder="grid">
                                    </dt>
                                </div>
                                <div class="form-group col">
                                    <dt data-toggle="tooltip" title="Nationality of the racer. The synergy between nationality and
                                     circuit_id is a factor that sports-betters usually considers important">
                                    <label for="nationality">nationality</label><i class="fa fa-question-circle"></i>
                                    <input type="text" id="nationality" value="Finnish" name="nationality" class="form-control"
                                           placeholder="nationality"></dt></div>

                            </div>
                            <div class = "row">
                                <div class="form-group col" style = "padding:0px 0px 0px 0px; margin:0px 0px 16px 15px;">
                                    <dt data-toggle="tooltip" title="Age of the driver. Possibly important.">
                                <label for="driver_age">driver_age</label><i class="fa fa-question-circle"></i>
                                <input type="text" style="width:120px; height:40px;"id="driver_age" name="driver_age" class="form-control"
                                       placeholder="driver_age" value="30"> </dt>
                            </div>
                            <div class="form-group col" style = "padding:0px 0px 0px 0px; margin:0px 0px 16px 15px;">
                                <dt data-toggle="tooltip" title="Time it took for the racer to qualify for the current race. Higher
                                    value is better.(Higher performance)" style="">
                                    <label for="qualifying_time">qualifying_time</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px;"id="qualifying_time" value="0.194" name="qualifying_time"
                                           class="form-control"
                                           placeholder="qualifying_time"></dt>
                                </div>

                                <div class="form-group col"style = "padding:0px 0px 0px 0px; margin:0px 0px 16px 20px;">
                                    <dt data-toggle="tooltip" title="This racer's accumulated points in this season before this race.
                                    Higher value indicates a racer in form.">
                                    <label for="driver_points">driver_points</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px;"id="driver_points" value="314" name="driver_points" class="form-control"
                                           placeholder="driver_points"></dt></div>
                            </div>

                            <div class = "row">
                                <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 16px 15px;">
                                    <dt data-toggle="tooltip" title="Number of wins for the driver before this race in current season.
                                    Important for detecting form of the driver.">
                                    <label for="driver_wins" >driver_wins</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px; " id="driver_wins"  name="driver_wins" value="4" class="form-control"
                                           placeholder="driver_wins"></dt>
                                </div>
                                <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 67px;">
                                    <dt data-toggle="tooltip" title="Average placement of the driver for all the races before this one in current season.">
                                    <label for="driver_standings_pos"  >driver_standings_pos</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px;" id="driver_standings_pos" value="2" name="driver_standings_pos"
                                           class="form-control" placeholder="driver_standings_pos"></dt></div>
                            <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 10px;">
                                <dt data-toggle="tooltip" title="The team that makes and maintains the car for the racer. Hugely important factor in the races.
                                Mclaren, Ferrari etc. many very well known constructors who regularly wins and have very high reputation for making solid cars.">
                                    <label for="constructor" style = "padding:0px 1px 0px 0px;">constructor</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px;"id="constructor" value="mercedes" name="constructor" class="form-control"
                                           placeholder="constructor"></dt>
                                </div>
                            </div>
                            <div class = "row">
                                <div class="form-group" style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 0px;">
                                    <dt data-toggle="tooltip" title="This constructor's accumulated points in this season before this race.
                                    Higher value indicates a better reputed/in form constructor. After each race, all the constructors of the race also get points separately fromm the racer's point.">
                                    <label for="constructor_points" style="margin:0px 0px 8px 0px;">constructor_points</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px;margin:0px 0px 1px 15px;" id="constructor_points" value="701" name="constructor_points"
                                           class="form-control" placeholder="constructor_points"></dt>
                                </div>


                                <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 11px;">
                                    <dt data-toggle="tooltip" title="This constructor's accumulated wins in this season before this race.
                                    Higher value indicates a better reputed/in form constructor.">
                                    <label for="constructor_wins">constructor_wins</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px; margin:0px 0px 1px 25px;" id="constructor_wins" value="14" name="constructor_wins"
                                           class="form-control" placeholder="constructor_wins"></dt></div>
                                <div class="form-group "style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 0px;">
                                    <dt data-toggle="tooltip" title="This constructor's average standings in this season before this race.
                                    Lower value indicates a better reputed/in form constructor.">
                                    <label for="constructor_standings_pos" style="margin:0px 0px 8px 10px;">constructor_standings_pos</label><i class="fa fa-question-circle"></i>
                                    <input type="text" style="width:120px; height:40px; margin:0px 0px 1px 70px;" id="constructor_standings_pos" value="1"
                                           name="constructor_standings_pos"
                                           class="form-control" placeholder="constructor_standings_pos"></dt>
                                </div>
                            </div>

                        </div>
                    </div>


                    <a data-toggle="pill" href="#nav-tab-year"
                       class="nav-link rounded-pill">
                        <button
                                class="subscribe btn btn-primary btn-block rounded-pill shadow-sm" onclick="fun()">
                            Predict
                        </button>
                    </a>
                </div>
                <!-- End -->
                <div class="show_data">
                </div>
                <div id="start_over">
                </div>

            </div>
        </div>
    </form>
</div>
<script>
    //Return JSON Object
    let ret = {}, feats = 1, params_list = [];


    function featshow() {

        let mylist = document.getElementById('featsel');

        if (mylist.options[mylist.selectedIndex].value.includes('remove')) {
            document.getElementById('addfeat').style.display = 'block';
            document.getElementById('text').style.display = 'block'
        } else {
            document.getElementById('addfeat').style.display = 'none';
            document.getElementById('text').style.display = 'none'

        }
    }

    function addElement(parentID, elementTag, cls) {
        // if (feats === 0) {
        //     feats = 1;
        // }
        feats = feats + 1;
        var p = document.getElementById(parentID);
        var newElement = document.createElement(elementTag);
        newElement.setAttribute('id', `feat${feats - 1}`);
        newElement.setAttribute('class', cls);
        newElement.style.margin = "5px";
        newElement.innerHTML = `
        <br >
        <hr style="FILTER: alpha(opacity=100,finishopacity=0,style=2)" width="100%" color=#060607 SIZE=100>
        <br>
                            <div class = "row">
                                <div class="form-group col" >
                                    <label for="season">season</label>
                                    <input type="text" id="season" name="season" value="2019" class="form-control"
                                           placeholder="season">
                                </div>
                                <div class="form-group col">
                                    <label for="round">round</label>
                                    <input type="text" id="round" name="round" value="21" class="form-control" placeholder="round">
                                </div>
                                <div class="form-group col">
                                <label for="weather0">weather</label>
                                <select  class="form-control" id="weather0">
                                    <option value="warm" selected>warm</option>
                                    <option value="cold">cold</option>
                                    <option value="dry">dry</option>
                                    <option value="wet">wet</option>
                                    <option value="cloudy">cloudy</option>
                                </select></div>


                            </div>

                            <div class = "row">
                                <div class="form-group col">
                                    <label for="circuit_id">circuit_id</label>
                                    <input type="text" id="circuit_id" value="yas_marina" name="circuit_id" class="form-control"
                                           placeholder="circuit_id">
                                </div>
                                <div class="form-group col">
                                    <label for="grid">grid</label>
                                    <input type="text" id="grid" name="grid" value="20" class="form-control"
                                           placeholder="grid">
                                </div>
                                <div class="form-group col">
                                    <label for="nationality">nationality</label>
                                    <input type="text" id="nationality" value="Finnish" name="nationality" class="form-control"
                                           placeholder="nationality"></div>

                            </div>
                            <div class = "row">
                                <div class="form-group col">
                                <label for="driver_age">driver_age</label>
                                <input type="text" id="driver_age" name="driver_age" class="form-control"
                                       placeholder="driver_age" value="30">
                            </div>
                            <div class="form-group col">
                                    <label for="qualifying_time">qualifying_time</label>
                                    <input type="text" id="qualifying_time" value="0.194" name="qualifying_time"
                                           class="form-control"
                                           placeholder="qualifying_time">
                                </div>

                                <div class="form-group col">
                                    <label for="driver_points">driver_points</label>
                                    <input type="text" id="driver_points" value="314" name="driver_points" class="form-control"
                                           placeholder="driver_points"></div>
                            </div>

                            <div class = "row">
                                <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 16px 15px;">
                                    <label for="driver_wins" >driver_wins</label>
                                    <input type="text" style="width:120px; height:40px; " id="driver_wins"  name="driver_wins" value="4" class="form-control"
                                           placeholder="driver_wins">
                                </div>
                                <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 67px;">
                                    <label for="driver_standings_pos"  >driver_standings_pos</label>
                                    <input type="text" style="width:120px; height:40px;" id="driver_standings_pos" value="2" name="driver_standings_pos"
                                           class="form-control" placeholder="driver_standings_pos"></div>
                            <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 35px;">
                                    <label for="constructor" style = "padding:0px 1px 0px 0px;">constructor</label>
                                    <input type="text" style="width:120px; height:40px;"id="constructor" value="mercedes" name="constructor" class="form-control"
                                           placeholder="constructor">
                                </div>
                            </div>
                            <div class = "row">
                                <div class="form-group" style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 15px;">
                                    <label for="constructor_points">constructor_points</label>
                                    <input type="text" style="width:120px; height:40px;" id="constructor_points" value="701" name="constructor_points"
                                           class="form-control" placeholder="constructor_points">
                                </div>


                                <div class="form-group " style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 50px;">
                                    <label for="constructor_wins">constructor_wins</label>
                                    <input type="text" style="width:120px; height:40px;" id="constructor_wins" value="14" name="constructor_wins"
                                           class="form-control" placeholder="constructor_wins"></div>
                                <div class="form-group "style = "padding:0px 0px 0px 0px; margin:0px 0px 1px 30px;">
                                    <label for="constructor_standings_pos">constructor_standings_pos</label>
                                    <input type="text" style="width:120px; height:40px; margin:0px 0px 1px 35px;" id="constructor_standings_pos" value="1"
                                           name="constructor_standings_pos"
                                           class="form-control" placeholder="constructor_standings_pos">
                                </div>


        `
        p.appendChild(newElement);
    }

    function fun() {
        for (let t = 0; t < feats; t++) {
            // console.log(feats)
            const params = {}
            const lis = ['season', 'round', 'circuit_id',
                'nationality', 'constructor', 'grid', 'driver_points', 'driver_wins', 'driver_standings_pos', 'constructor_points',
                'constructor_wins', 'constructor_standings_pos', 'qualifying_time', 'driver_age']
            for (let i = 0; i < lis.length; i++) {
                let items = document.querySelectorAll("#" + lis[i]);
                params['' + lis[i]] = items[t].value
            }
            let weather0 = document.querySelectorAll("#weather0");
            params[weather0[t].value] = true
            params_list.push(params);
        }
        $.ajax({
                url: '/prediction',
                method: "post",
                data: {'data': JSON.stringify(params_list)},
                success(data_all) {
                    params_list = [];
                    var data = data_all['data'];
                    let txt = "";
                    for (let i = 0; i < data.length; i++) {
                        txt += data[i] + "</br>";
                    }
                    $(".show_data").html(txt);
                    $("#start_over").html("<a href=\"/\"><span class=\"btn btn-info\">start over from beginning</span></a>\n");
                }
            }
        )

    }
</script>
</body>
</html>